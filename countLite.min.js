/*
 *****************************************************
 * Count Lite Plugin
 *
 * @author    Ryan Davis <ryan@mediaflydesign.com>
 * @version   Release: 1.0.1
 * @modified  5/16/12
 *
 * Licences: MIT, GPL
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 ******************************************************
*/
;(function($,window,document,undefined){var pluginName='countLite',defaults={views:10,days:7,instance:'cl_',uniquePathViews:false,maxViews:function(){},callBack:function(){}};function Plugin(element,options){this.element=element;this.options=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this._cookieName=this.options.instance+'count';this._cookieDate=this.options.instance+'date';this._cookiePage=this.options.instance+'page';this._init()}Plugin.prototype={_init:function(){var cookiesEnabled=(navigator.cookieEnabled)?true:false;if(!cookiesEnabled)return false;this.options.days=parseInt(this.options.days);this.options.views=parseInt(this.options.views);var currentCount=this._getViews();var remaining=(this.options.views-currentCount);var callBackData={'count':currentCount,'views':this.options.views,'remaining':remaining,'days':this.options.days};this.options.callBack(callBackData);if(currentCount>=this.options.views){this.options.maxViews(callBackData)}else{if(this.options.uniquePathViews)this._pageTracked();if(!this.options.uniquePathViews||this.options.uniquePathViews&&!this._pageWasTracked())this._addView(currentCount)}},_getViews:function(){if(!this._readCookie(this._cookieName))this._setCookie(this._cookieName,1,this.options.days);if(!this._readCookie(this._cookieDate))this._setCookie(this._cookieDate,this._expireDate(),this.options.days);return parseInt(this._readCookie(this._cookieName))},_addView:function(count){var count=(count+1);this._setCookie(this._cookieName,count,null,this._expireDate(true))},_pageTracked:function(){this._setCookie(this._cookiePage,1,null,this._expireDate(true),1)},_pageWasTracked:function(){return this._readCookie(this._cookiePage)},_setCookie:function(name,value,days,date,path){if(days){var expires="; expires="+this._expireString(this.options.days)}else if(date){var expires="; expires="+date}else{var expires="; expires="+this._expireString(-2)}path=(!path?'/':null);document.cookie=name+"="+value+expires+"; path="+path},_readCookie:function(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null},_deleteCookie:function(name){this._setCookie(name,'',null)},_expireString:function(days){if(!days)return null;var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));return date.toGMTString()},_expireDate:function(fromCookie){if(fromCookie)return this._readCookie(this._cookieDate);return this._expireString(this.options.days)},destroy:function(){this._deleteCookie(this._cookieName);this._deleteCookie(this._cookieDate);this._deleteCookie(this._cookiePage)}};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,pluginName)){$.data(this,pluginName,new Plugin(this,options))}})}})(jQuery,window,document);